# 便玩录 (Convenient Play Record)

这是一个基于Android的多功能智能便签应用，使用Kotlin语言开发，采用MVVM架构模式。

## 功能特点

1. 笔记本管理
   - 创建、编辑、删除笔记本
   - 笔记本列表展示
   - 笔记本内笔记数量统计
   - 支持默认笔记本

2. 笔记管理
   - 创建、编辑、删除笔记
   - 笔记按创建时间/修改时间排序
   - 笔记搜索功能
   - 笔记列表展示
   - 支持笔记分类管理
   - **新增**：长按拖拽排序功能
   - **新增**：左滑显示操作菜单（置顶/删除）

3. 待办事项
   - 创建、编辑、删除待办事项
   - 待办事项完成状态跟踪
   - 待办列表展示

4. 计时器功能
   - 自定义计时设置
   - 专注模式

5. 游戏功能
   - 休闲小游戏

6. 个人设置
   - 深色/浅色模式切换
   - 用户反馈（QQ群、邮件、公众号）
   - 关于我们信息
   - 用户协议与隐私政策

7. 界面特点
   - 使用Bottom Navigation管理主要功能界面
   - Material Design 3风格的界面设计
   - 沉浸式状态栏
   - 圆角对话框设计

## 技术架构

- 开发语言：Kotlin
- 架构模式：MVVM
- 数据库：Room
- 主要组件：
  - BottomNavigationView
  - ViewPager2
  - RecyclerView
  - Fragment
  - ViewModel
  - LiveData
  - Navigation
  - Material Components

## 项目结构

```
app/
├── data/
│   ├── database/        # Room数据库相关
│   │   └── AppDatabase.kt
│   ├── dao/            # 数据访问对象
│   │   ├── NoteDao.kt
│   │   └── NotebookDao.kt
│   ├── model/          # 数据模型
│   │   ├── Note.kt
│   │   └── Notebook.kt
│   └── repository/     # 数据仓库
│       ├── NoteRepository.kt
│       └── NotebookRepository.kt
├── ui/
│   ├── notes/         # 笔记相关界面
│   ├── notebook/      # 笔记本相关界面
│   ├── todos/         # 待办事项相关界面 
│   ├── timer/         # 计时器功能
│   ├── game/          # 游戏相关界面
│   ├── profile/       # 个人设置界面
│   │   ├── ProfileFragment.kt         # 个人设置主界面
│   │   ├── DarkModeFragment.kt        # 深色模式设置
│   │   ├── UserAgreementFragment.kt   # 用户协议与隐私政策
│   │   └── AgreementPagerAdapter.kt   # 协议页面适配器
│   └── search/        # 搜索功能界面
└── utils/             # 工具类
```

## 使用说明

1. 笔记本管理
   - 点击底部导航栏笔记本按钮进入笔记本管理界面
   - 点击右下角"+"按钮创建新笔记本
   - 点击笔记本项目进入该笔记本
   - 长按或点击更多按钮可编辑/删除笔记本

2. 笔记功能
   - 在笔记本中点击右下角"+"按钮创建新笔记
   - 点击笔记列表项编辑已有笔记
   - 使用右上角搜索框搜索笔记
   - **拖拽排序**：长按笔记项目可拖拽调整顺序
     - 拖拽时笔记会有视觉反馈（半透明+轻微放大）
     - 松手后自动保存新的排序
   - **侧滑操作**：向左滑动笔记项目显示操作菜单
     - 橙色"置顶"按钮：将笔记移动到列表顶部
     - 红色"删除"按钮：删除当前笔记（带圆角设计）
     - 滑动距离超过1/3自动展开菜单，否则回弹
     - 点击菜单按钮执行对应操作并收起菜单
     - 菜单宽度：每个按钮90dp，总宽度180dp
   - **注意**：编辑模式下拖拽和侧滑功能会自动禁用

3. 待办事项
   - 点击底部导航栏待办按钮进入待办列表
   - 点击右下角"+"按钮添加新待办
   - 点击复选框标记完成/未完成
   - 长按待办项目进行编辑或删除

4. 计时器功能
   - 点击底部导航栏计时器按钮进入计时器界面
   - 设置专注时间和休息时间
   - 点击开始按钮开始计时

5. 游戏功能
   - 点击底部导航栏游戏按钮进入游戏界面
   - 选择游戏开始游玩

6. 个人设置
   - 点击底部导航栏个人按钮进入设置界面
   - 点击深色模式进行外观切换
   - 点击用户反馈可通过QQ群、邮件或公众号方式反馈
     - QQ群：长按复制群号或点击加入群聊
     - 邮件：点击复制邮箱地址或打开邮件应用
     - 公众号：长按保存二维码或扫描加入
   - 点击关于我们查看应用信息
   - 点击用户协议与隐私政策查看相关法律文件

## 开发进度

- [x] 基础框架搭建
- [x] 笔记本管理功能
- [x] 笔记列表展示
- [x] 笔记编辑功能
- [x] 笔记搜索功能
- [x] **新增**：笔记拖拽排序功能
- [x] **新增**：笔记侧滑操作菜单
- [x] 待办事项管理
- [x] 计时器功能
- [x] 游戏功能
- [x] 个人设置
  - [x] 深色模式切换
  - [x] 用户反馈
  - [x] 关于我们
  - [x] 用户协议与隐私政策
- [x] 沉浸式状态栏实现
- [ ] 用户数据云同步
- [ ] 多设备支持

## 技术实现细节

### 笔记拖拽和侧滑功能

**核心组件：**
1. `DragSwipHelper.kt` - 拖拽功能辅助类
   - 使用 `ItemTouchHelper` 实现长按拖拽
   - 支持上下方向拖拽排序
   - 提供拖拽时的视觉反馈（透明度、缩放）
   - 实现 `OnItemMoveListener` 接口处理拖拽事件

2. `SwipItemHelper.kt` - 侧滑菜单辅助类
   - **核心思路**：侧滑菜单隐藏在item底部，通过移动CardView露出菜单
   - 布局结构：FrameLayout包含菜单层(底部)和CardView层(顶部)
   - 通过控制CardView的translationX实现滑动效果
   - 菜单始终在底部，不需要控制visibility
   - 使用 `RecyclerView.OnItemTouchListener` 处理触摸事件
   - 支持左滑显示置顶和删除按钮，滑动距离智能判断
   - 可动态启用/禁用侧滑功能

**数据库更新：**
- Note模型新增 `sortOrder` 字段用于排序
- 数据库版本升级到 version 4
- NoteDao 新增排序相关查询方法
- Repository 层新增置顶和移动笔记的业务逻辑

**使用方法：**
```kotlin
// 在 Fragment 中集成
dragSwipHelper = DragSwipHelper()
dragSwipHelper.attachSwipAndDragRecyclerView(recyclerView, adapter)

swipItemHelper = SwipItemHelper(adapter)
swipItemHelper.attachRecyclerView(recyclerView)
```

**设计模式应用：**
- 接口隔离原则：分离拖拽和侧滑接口
- 单一职责原则：每个Helper类只负责一种交互
- 观察者模式：通过回调接口通知业务层处理事件

## 已知问题和改进方向

1. **性能优化**
   - 大量笔记时拖拽可能有轻微延迟
   - 建议：实现虚拟化或分页加载

2. **用户体验**
   - 侧滑菜单可以增加更多操作选项（如分享、复制等）
   - 拖拽时可以添加震动反馈

3. **数据一致性**
   - 当前排序只在本地生效
   - 建议：云同步时需要处理排序冲突

4. **无障碍支持**
   - 需要为拖拽和侧滑操作添加无障碍描述
   - 建议：提供替代的操作方式
